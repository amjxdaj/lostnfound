{% extends 'core/base.html' %}
{% load static %}
{% block title %}My Profile{% endblock %}

{% block content %}
<style>
/* Header row */
.section-header{
  display:flex; align-items:center; justify-content:space-between;
  gap:16px; margin-bottom:1rem;
}
.section-title{ margin:0; line-height:1; letter-spacing:.06em; }
.section-sub{ margin:0; color:#bbb; font-size:.95rem; }

/* Container for lists */
.items-container{
  display:flex; flex-direction:column; gap:1rem; margin-top:1rem;
}

/* Card (same style as lost list) */
.item-card{
  display:flex; flex-direction:column; gap:.75rem;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(0,178,255,.4);
  border-radius:12px;
  padding:1rem 1.5rem;
  transition:transform .2s ease, box-shadow .2s ease;
}
.item-card:hover{ transform:translateY(-3px); box-shadow:0 6px 15px rgba(0,178,255,.4); }

/* Top row inside card */
.item-row{ display:flex; justify-content:space-between; align-items:center; gap:1rem; }

/* Left: image + fields */
.item-left{ display:flex; align-items:center; gap:1rem; }
.item-image{ width:55px; height:55px; border-radius:50%; object-fit:cover; border:2px solid #00b2ff; }
.item-info{ display:flex; gap:1.2rem; font-size:.9rem; color:#fff; }
.item-info span{ white-space:nowrap; }

/* Right: actions */
.item-right{ display:flex; gap:.6rem; }

/* Buttons */
.cta-button{ padding:7px 14px; border-radius:6px; font-size:.85rem; font-weight:bold; text-decoration:none; transition:.2s; }
.cta-primary{ background:linear-gradient(to right,#ff6600,#00aaff); color:#fff; }
.cta-secondary{ background:transparent; border:1px solid #ff6600; color:#ff6600; }
.cta-button:hover{ opacity:.8; }

/* Delete button (POST form) */
.delete-form{ margin:0; }
.delete-btn{ padding:7px 14px; border-radius:6px; font-size:.85rem; font-weight:700;
  background:transparent; border:1px solid #ff4d4d; color:#ff4d4d; cursor:pointer; }
.delete-btn:hover{ opacity:.85; }

/* Expand details */
.expanded{ display:none; color:#ccc; font-size:.85rem; }
.item-card.active .expanded{ display:block; }

/* Messages */
.messages{ list-style:none; padding:0; margin: 1rem 0; }
.messages li{ padding:.6rem 1rem; border-radius:6px; margin-bottom:.5rem; font-weight:600; font-size:.9rem; }
.messages li.success{ background:rgba(0,255,100,.12); border:1px solid #00ff64; color:#00ff64; }

/* Mobile */
@media (max-width:640px){
  .section-header{ flex-direction:column; align-items:flex-start; gap:.5rem; }
  .item-row{ flex-direction:column; align-items:flex-start; gap:.75rem; }
  .item-right{ flex-wrap:wrap; }
}
</style>

<section class="features">

  <div class="section-header">
  <h2 class="section-title">MY PROFILE</h2>
  <div style="display:flex; align-items:center; gap:1rem;">
    <p class="section-sub">Signed in as <strong>{{ request.user.username }}</strong></p>

    <!-- Logout form -->
    <form method="post" action="{% url 'logout' %}" class="delete-form">
      {% csrf_token %}
      <button type="submit" class="cta-button cta-primary"
              onclick="return confirm('Do you really want to log out?');">
        Logout
      </button>
    </form>
  </div>
</div>

  {% if messages %}
    <ul class="messages">
      {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <!-- LOST ITEMS -->
  <div class="section-header" style="margin-top:1.75rem;">
    <h2 class="section-title">MY LOST ITEMS</h2>
  </div>
  <div class="items-container">
    {% for item in my_lost %}
      <div class="item-card">
        <div class="item-row">
          <div class="item-left">
            {% if item.image %}
              <img src="{{ item.image.url }}" alt="{{ item.title }}" class="item-image">
            {% else %}
              <img src="{% static 'default.png' %}" alt="No Image" class="item-image">
            {% endif %}
            <div class="item-info">
              <span><strong>Title:</strong> {{ item.title }}</span>
              <span><strong>Location:</strong> {{ item.location }}</span>
              <span><strong>Date:</strong> {{ item.date_lost|date:"M d, Y" }}</span>
              <span><strong>Reward:</strong> {{ item.reward|default:"None" }}</span>
            </div>
          </div>
          <div class="item-right">
            <!-- <a href="{% url 'report_found' %}?item={{ item.id }}" class="cta-button cta-primary">Report Found</a> -->
            <form method="post" action="{% url 'delete_lost_item' item.id %}" class="delete-form">
              {% csrf_token %}
              <button type="submit" class="delete-btn" onclick="return confirm('Delete this lost item?');">Delete</button>
            </form>
          </div>
        </div>
        <div class="expanded">
          <p><strong>Description:</strong> {{ item.description }}</p>
        </div>
      </div>
    {% empty %}
      <p class="no-items">You haven’t reported any lost items.</p>
    {% endfor %}
  </div>

  <!-- FOUND ITEMS -->
  <div class="section-header" style="margin-top:2rem;">
    <h2 class="section-title">MY FOUND ITEMS</h2>
  </div>
  <div class="items-container">
    {% for item in my_found %}
      <div class="item-card">
        <div class="item-row">
          <div class="item-left">
            {% if item.image %}
              <img src="{{ item.image.url }}" alt="{{ item.title }}" class="item-image">
            {% else %}
              <img src="{% static 'default.png' %}" alt="No Image" class="item-image">
            {% endif %}
            <div class="item-info">
              <span><strong>Title:</strong> {{ item.title }}</span>
              <span><strong>Location:</strong> {{ item.location }}</span>
              <span><strong>Date:</strong> {{ item.date_found|date:"M d, Y" }}</span>
            </div>
          </div>
          <div class="item-right">
            <!-- <a href="{% url 'report_lost' %}?found={{ item.id }}" class="cta-button cta-secondary">I Lost This</a> -->
            <form method="post" action="{% url 'delete_found_item' item.id %}" class="delete-form">
              {% csrf_token %}
              <button type="submit" class="delete-btn" onclick="return confirm('Delete this found item?');">Delete</button>
            </form>
          </div>
        </div>
        <div class="expanded">
          <p><strong>Description:</strong> {{ item.description }}</p>
        </div>
      </div>
    {% empty %}
      <p class="no-items">You haven’t reported any found items.</p>
    {% endfor %}
  </div>

</section>

<script>
  // Expand/collapse description on card click (ignore action buttons/forms)
  document.querySelectorAll(".item-card").forEach(card=>{
    card.addEventListener("click", e=>{
      if (e.target.closest('.cta-button') || e.target.closest('form')) return;
      card.classList.toggle("active");
    });
  });
</script>
{% endblock %}
